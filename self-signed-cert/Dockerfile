# Start from the official Golang image
FROM golang:1.21-alpine AS build
WORKDIR /app
COPY main.go .
RUN go build -o server main.go

# Generate certificates (expecting them to be present, or generated by script)
# Use a minimal image for runtime
FROM alpine:3.19
WORKDIR /app
COPY --from=build /app/server .
COPY certs/server.crt certs/server.key certs/chain.crt ./
COPY certs/server-bundle.crt ./
EXPOSE 8080
CMD ["./server"]
